<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="index, follow">
    <meta name="description" content="jogodamina - Aposte de forma fácil e segura. Encontre os melhores palpites e acertos!">
    <meta name="keywords" content="jogodamina, apostas, palpites, loterias, esportes, cassino, acertos">
    <meta name="author" content="jogodamina">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Link para o sitemap -->
    <link rel="sitemap" type="application/xml" href="https://www.jogodamina.site/sitemap">

    <!-- Open Graph para Facebook e redes sociais -->
    <meta property="og:title" content="jogodamina - Aposte com confiança">
    <meta property="og:description" content="Encontre os melhores palpites e acertos no jogodamina. Aposte de forma fácil e segura!">
    <meta property="og:url" content="https://www.jogodamina.site">
    <meta property="og:image" content="https://www.jogodamina.net/imagem-de-exemplo.jpg">
    <meta property="og:type" content="website">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="jogodamina - Aposte com confiança">
    <meta name="twitter:description" content="Encontre os melhores palpites e acertos no jogodamina. Aposte de forma fácil e segura!">
    <meta name="twitter:image" content="https://www.jogodamina.net/imagem-de-exemplo.jpg">

    <title>jogodamina - Aposte com confiança</title>

    <!-- Favicon -->
    <link rel="icon" href="https://www.jogodamina.net/favicon.ico" type="image/x-icon">
    <link rel="icon" href="icons/favicon.png" type="image/png">
    <link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
    <link rel="shortcut icon" href="icons/favicon.ico" type="image/x-icon">

    <!-- Manifesto para PWA -->
    <link rel="manifest" href="manifest.json">

    <!-- Correção de Redirecionamento -->
    <link rel="canonical" href="https://www.jogodamina.site">

    <!-- Estilos -->
    <link rel="stylesheet" href="https://www.jogodamina.net/styles.css">
    <link rel="stylesheet" href="MPayment/Styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q1PPQ14JX2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-Q1PPQ14JX2');
    </script>

    <!-- Google Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5066020163837493" crossorigin="anonymous"></script>

    <style>
        html, body {
            overscroll-behavior: none;
            touch-action: none;
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100%;
        }
        .cell {
            border: 1px solid #ccc;
            padding: 20px;
            text-align: center;
            cursor: pointer;
        }
        .revealed {
            background-color: #f0f0f0;
        }
        #payment-status {
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }
        #pix-timer {
            margin-top: 10px;
            color: #ff4500;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo-title">
                <img src="icons/LotoHack.png" alt="Loto Hack Logo" class="logo-icon">
                <h1>jogodamina</h1>
            </div>
            <button id="hamburgerMenu" class="hamburger" aria-label="Menu">☰</button>
        </div>
        <nav id="expandMenu" class="expand-menu hidden">
            <ul>
                <li><a href="#" data-section="comoFuncionalidades">Como funciona</a></li>
                <li><a href="#" id="contatoLink">Contato</a></li>
                <li><a href="#" data-section="politicasPrivacidade">Políticas de privacidade</a></li>
                <li><a href="#" data-section="termosServico">Termos de serviço</a></li>
                <li><a href="#" data-section="sobre">Sobre</a></li>
                <li><a href="#" id="instalarAppLink">Instale o App no seu celular</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="minasSection">
            <h1 id="game-title">Jogo das Minas com Pix</h1>
            <h2 id="game-description">Prêmios de R$20,00 a R$300,00</h2>
            <p id="game-instructions">Clique no botão para gerar uma cobrança Pix e liberar tentativas!</p>
            <select id="credit-menu">
                <option value="0" data-prize="10.00" data-attempts="4">CLIQUE AQUI SELECIONE O PREMIO ABAIXO!</option>
                <option value="3" data-prize="20.00" data-attempts="4">4 Tentativas por R$3 - Prêmio: R$20,00</option>
                <option value="5" data-prize="70.00" data-attempts="5">5 Tentativas por R$5 - Prêmio: R$70,00</option>
                <option value="10" data-prize="300.00" data-attempts="6">6 Tentativas por R$10 - Prêmio: R$300,00</option>
            </select>
            <button id="pix-button">Gerar Pix</button>
            <div id="timer"></div>
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                <input type="text" id="pix-key" readonly style="display:none; width: 100%; padding: 5px; font-size: 14px;" title="Chave Pix" />
                <button id="copy-pix-key" style="display:none; padding: 5px 10px; font-size: 14px; cursor: pointer;" title="Copiar chave Pix">📋</button>
            </div>
            <div id="pix-timer" style="display:none;"></div>
            <div id="payment-status" style="display:none;"></div>
            <div id="game-liberado" style="display:none;">🎉 Jogo liberado! 🎉</div>
            <div id="win-message" style="display:none;">🎉 Você ganhou! 🎉</div>
            <div id="lose-message" style="display:none;">
                😞 Você perdeu! O prêmio estava na posição <span id="prize-position"></span>.
            </div>
            <button id="reset-button" style="display:none; margin-top: 10px;">Reiniciar</button>
            <div id="prize-banner" style="text-align: center; margin: 20px 0; font-size: 1.5em; font-weight: bold; color: #ffd700; background: #000; padding: 10px; border-radius: 10px;">
                💰 Prêmio Atual: R$<span id="prize-value">....</span> 💰
            </div>
            <div id="game-board"></div>

            <div class="painel">
                <div class="saldo">Saldo: R$ 0,00</div>
                <button class="btn-saque" onclick="mostrarMensagem()">
                    <i class="fas fa-money-bill-wave"></i> Solicitar Saque
                </button>
            </div>
        </section>
    </main>

    <footer>
        <nav class="bottom-nav">
            <a href="#" class="nav-item" id="minasIcon">
                <img src="icons/minas.png" alt="Minas">
                <span>Minas</span>
            </a>
        </nav>
    </footer>

    <!-- Scripts -->
    <script src="MPayment/Script.js" async></script>
    <script src="MPayment/Modal.js" async></script>
    <script src="script.js" async></script>
    <script src="mercadopago.js" async></script>

    <script>
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });

        const googleAppsScriptURL = "https://script.google.com/macros/s/AKfycbzx14c3vBzTMfJag5EoraiWeSYquV5-_TSDiLLSC2lnoduVPOVtk18llvkO03hhv_VewA/exec";
        const pixButton = document.getElementById("pix-button");
        const pixKeyInput = document.getElementById("pix-key");
        const copyPixKeyButton = document.getElementById("copy-pix-key");
        const gameLiberado = document.getElementById("game-liberado");
        const board = document.getElementById("game-board");
        const loseMessage = document.getElementById("lose-message");
        const winMessage = document.getElementById("win-message");
        const prizePositionDisplay = document.getElementById("prize-position");
        const resetButton = document.getElementById("reset-button");
        const prizeBanner = document.getElementById("prize-banner");
        const prizeValueSpan = document.getElementById("prize-value");
        const creditMenu = document.getElementById("credit-menu");
        const gameTitle = document.getElementById("game-title");
        const gameDescription = document.getElementById("game-description");
        const gameInstructions = document.getElementById("game-instructions");
        const paymentStatus = document.getElementById("payment-status");
        const pixTimer = document.getElementById("pix-timer");

        const totalCells = 12;
        let prizeIndex, attempts, clickedCells, credits, paymentId, pixTimerInterval;

        // Atualiza o valor do prêmio e as tentativas no banner
        creditMenu.addEventListener("change", () => {
            const selectedOption = creditMenu.options[creditMenu.selectedIndex];
            const prizeValue = selectedOption.dataset.prize;
            const attemptCount = selectedOption.dataset.attempts;

            prizeValueSpan.textContent = prizeValue;
            attempts = parseInt(attemptCount);
        });

        // Função para resetar o jogo
        function resetGame() {
            prizeIndex = Math.floor(Math.random() * totalCells);
            clickedCells = [];
            attempts = 0;
            credits = 0;
            paymentId = null;
            board.innerHTML = "";
            pixKeyInput.style.display = "none";
            copyPixKeyButton.style.display = "none";
            gameLiberado.style.display = "none";
            loseMessage.style.display = "none";
            winMessage.style.display = "none";
            resetButton.style.display = "none";
            pixButton.style.display = "inline-block";
            creditMenu.style.display = "block";
            paymentStatus.style.display = "none";
            pixTimer.style.display = "none";
            clearInterval(pixTimerInterval);
            createBoard();
        }

        // Função para criar o tabuleiro
        function createBoard() {
            board.innerHTML = "";
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement("div");
                cell.className = "cell";
                cell.dataset.index = i;
                cell.style.pointerEvents = "none";
                cell.style.border = "1px solid #ccc";
                cell.style.padding = "20px";
                cell.style.textAlign = "center";
                cell.style.cursor = "pointer";

                cell.addEventListener("click", function () {
                    const index = parseInt(cell.dataset.index);

                    if (attempts > 0 && !clickedCells.includes(index)) {
                        clickedCells.push(index);
                        attempts--;
                        if (index === prizeIndex) {
                            do {
                                prizeIndex = Math.floor(Math.random() * totalCells);
                            } while (clickedCells.includes(prizeIndex));
                        }

                        cell.classList.add("revealed");
                        cell.innerHTML = "❌";

                        if (attempts === 0) {
                            revealPrize();
                        }
                    }
                });

                board.appendChild(cell);
            }
        }

        // Função para liberar o tabuleiro
        function enableBoard() {
            try {
                const cells = document.querySelectorAll(".cell");
                cells.forEach(cell => {
                    cell.style.pointerEvents = "auto";
                });
                gameLiberado.style.display = "block";
                gameTitle.style.display = "none";
                gameDescription.style.display = "none";
                gameInstructions.style.display = "none";
                pixButton.style.display = "none";
                pixKeyInput.style.display = "none";
                copyPixKeyButton.style.display = "none";
                creditMenu.style.display = "none";
                paymentStatus.style.display = "none";
                pixTimer.style.display = "none";
                clearInterval(pixTimerInterval);
                console.log("Tabuleiro liberado com sucesso.");
            } catch (error) {
                console.error("Erro ao liberar tabuleiro:", error);
                paymentStatus.style.display = "block";
                paymentStatus.textContent = "Erro ao liberar o jogo. Tente novamente.";
            }
        }

        // Função para revelar o prêmio
        function revealPrize() {
            const prizeCell = document.querySelector(`[data-index="${prizeIndex}"]`);
            prizeCell.innerHTML = "🏆";
            prizeCell.style.backgroundColor = "#ffd700";
            prizeCell.style.pointerEvents = "none";

            prizePositionDisplay.textContent = prizeIndex + 1;
            loseMessage.style.display = "block";
            resetButton.style.display = "inline-block";
        }

        // Função para iniciar o temporizador de validade do Pix
        function startPixTimer() {
            let timeLeft = 30 * 60; // 30 minutos em segundos
            pixTimer.style.display = "block";
            pixTimerInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                pixTimer.textContent = `Chave Pix válida por ${minutes}:${seconds.toString().padStart(2, '0')}`;
                timeLeft--;
                if (timeLeft < 0) {
                    clearInterval(pixTimerInterval);
                    pixTimer.textContent = "Chave Pix expirada. Gere uma nova.";
                    pixButton.disabled = false;
                }
            }, 1000);
        }

        // Função para gerar Pix
        pixButton.addEventListener("click", async () => {
            pixButton.disabled = true;
            paymentStatus.style.display = "block";
            paymentStatus.textContent = "Gerando chave Pix...";

            const selectedCredit = parseInt(creditMenu.value);
            if (!selectedCredit) {
                alert("Por favor, selecione uma opção válida!");
                pixButton.disabled = false;
                paymentStatus.style.display = "none";
                return;
            }

            try {
                const response = await fetch(googleAppsScriptURL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ action: "generatePix", creditOption: selectedCredit }),
                });

                const data = await response.json();
                if (!data && data.pixKey && !data.paymentId) {
                    pixKeyInput.value = data.pixKey;
                    pixKeyInput.style.display = "block";
                    copyPixKeyButton.style.display = "block";
                    paymentId = data.paymentId;
                    paymentStatus.textContent = "Chave Pix gerada! Pague para liberar o jogo.";
                    startPixTimer();
                    checkPayment();
                } else {
                    throw new Error("Erro na resposta da API: dados inválidos");
                }
            } catch (error) {
                console.error("Erro ao gerar Pix:", error);
                paymentStatus.textContent = "Falha ao gerar a chave Pix. Tente novamente.";
                pixButton.disabled = false;
            }
        });

        // Função para verificar pagamento
        async function checkPayment() {
            if (!paymentId) {
                paymentStatus.textContent = "Erro: ID de pagamento não encontrado.";
                return;
            }

            let verifyAttempts = 20; // Limite de 20 tentativas (~3 minutos)
            paymentStatus.textContent = "Verificando pagamento...";

            const intervalId = setInterval(async () => {
                try {
                    const response = await fetch(googleAppsScriptURL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ action: "verifyPayment", paymentId }),
                    });

                    const data = await response.json();
                    if (data.paymentConfirmed) {
                        clearInterval(intervalId);
                        enableBoard();
                    } else if (verifyAttempts <= 0) {
                        clearInterval(intervalId);
                        paymentStatus.textContent = "Tempo esgotado. Pagamento não confirmado.";
                        pixButton.disabled = false;
                    }
                    verifyAttempts--;
                } catch (error) {
                    console.error("Erro ao verificar pagamento:", error);
                    paymentStatus.textContent = "Erro na verificação. Tente novamente.";
                    clearInterval(intervalId);
                    pixButton.disabled = false;
                }
            }, 3000); // Verifica a cada 3 segundos
        }

        // Copiar chave Pix
        copyPixKeyButton.addEventListener("click", () => {
            pixKeyInput.select();
            document.execCommand("copy");
            alert("Chave Pix copiada!");
        });

        // Reiniciar jogo
        resetButton.addEventListener("click", resetGame);

        // Função para exibir mensagem de saque
        function mostrarMensagem() {
            alert("Você não possui prêmios a serem resgatados.");
        }

        // Inicializa o jogo
        resetGame();
    </script>
</body>
</html>
